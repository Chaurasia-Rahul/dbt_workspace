{% set query_result = run_query("SELECT DISTINCT EXTRACT(YEAR FROM order_date) AS year FROM stg.salesorderheader") %}
{% set distinct_years = query_result.columns[0].values() %}

{{ config(materialized='table') }}

{% for year in distinct_years %}
  {% set target_table_name = 'sales_order_' ~ year | int %}
  
  {{ config(target_table=target_table_name) }}

  SELECT 
    order_date, 
    sales_order_id 
  FROM 
    stg.salesorderheader 
  WHERE 
    EXTRACT(YEAR FROM order_date) = {{ year }}
{% endfor %}





